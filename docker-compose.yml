services:
  app:
    build: .
    ports:
      - "5009:5009"
    environment:
      # Load the API key from a .env file in the same directory as this docker-compose.yml
      # Create a file named .env and add the line: MISTRAL_API_KEY=your_actual_api_key
      MISTRAL_API_KEY: ${MISTRAL_API_KEY}
      # Set Flask/Gunicorn specific env vars if needed (optional, defaults in app.py/Dockerfile CMD are used)
      # FLASK_HOST: 0.0.0.0 # Gunicorn binds to this via CMD
      # FLASK_PORT: 5009 # Gunicorn binds to this via CMD
      # FLASK_DEBUG: 'False' # Set to 'True' for development debugging
      # UPLOAD_FOLDER: /app/uploads # Default is 'uploads' relative to WORKDIR /app
      # OUTPUT_FOLDER: /app/output # Default is 'output' relative to WORKDIR /app
      MAX_UPLOAD_MB: ${MAX_UPLOAD_MB:-100} # Max PDF upload size in MB (default 100)
      MISTRAL_MAX_MB: ${MISTRAL_MAX_MB:-50} # Mistral API max file size in MB (default 50)
      SERVER_NAME: ${SERVER_NAME:-localhost:5009} # Hostname and port for Flask's url_for (_external=True)
    # Optional volumes for persisting data outside the container (uncomment if needed)
    # volumes:
      # - ./uploads:/app/uploads # Persist uploaded files (app currently cleans this up)
      # - ./output:/app/output   # Persist generated output files
    # Override the default CMD to increase the worker timeout to 300 seconds (5 minutes)
    command: ["gunicorn", "--bind", "0.0.0.0:5009", "--timeout", "300", "app:app"]
